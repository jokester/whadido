# internal of whadido

## Parser

`src/parser` contains a simple parser-combinator. It is used by `src/analyze` to define operation patterns, and extract operations from reflogs.

## Assumptions when writing parsers

1. timestamp can be trusted
    - host's local time does not suddenly change (e.g. jump back to 1 year ago)
    - consequently we can group reflogs with their timestamp
2. no 2 commands is executed Simultaneously
    - it may be much harder to analyze interleaved reflog messages
3. reflog message is only generated by default `git` commands, and default behavior
    - `git --reflog-action` or `GIT_REFLOG_ACTION` may override reflog message
    - non c-git implementation may work differently
    - that said, we can still try to cover most everyday operations.

### memo: how is reflog messages generated (in c-git)

This is how I grep related code in `git` repo:

(this may not be a exhaustive way, will add more if I found them).

```text
$ cd ~/oss/git

$ grep -e reflog_message -e reflog_msg -Rin .
```

## Help `whadido` recognize more patterns

`whadido` uses hand-crafted parser heuristics when analyzing reflogs. this can be incomplete or incorrect.

If it fails to recognize your reflogs, you can help by submitting a dump of your reflogs and expected results.

Running `whadido --dump` would write the dump to a timestamp-named JSON file.

**WARNING**: this dump may contain private and/or sensitive data, please check its content before showing it in public.

A dump may include:

- *name* of branches / tags / remote repository
- *sha1* of commits / tags
- *content and timestamp* of git reflogs
- *log message* of commits
- *name and email* of git committers

A dump *does not* include:

- *content* of commits, files from commits / work tree / index
- *URL* and *path* of repository
